var __extends=this.__extends||function(e,t){function n(){this.constructor=e}n.prototype=t.prototype,e.prototype=new n},wijmo;(function(e){"use strict";var t=jQuery,n="wijdropdown",r=function(e){function n(){e.apply(this,arguments)}return __extends(n,e),n.prototype._setOption=function(t,n){var r=this,i=r.options.wijCSS;e.prototype._setOption.call(this,t,n),t==="disabled"&&(r._labelWrap.toggleClass(i.stateDisabled,n),r._label.toggleClass(i.stateDisabled,n),r.element.attr("disabled",n?"disabled":""))},n.prototype._create=function(){var e=this,n=e.element;window.wijmoApplyWijTouchUtilEvents&&(t=window.wijmoApplyWijTouchUtilEvents(t));if(n.get(0).tagName.toLowerCase()!=="select")return;n.is(":visible")?(e._activeItem=null,e._createSelect(),e._bindEvents(),e.needInit=!1):e.needInit=!0,e.element.is(":hidden")&&e.element.wijAddVisibilityObserver&&e.element.wijAddVisibilityObserver(function(){e.refresh(),e.element.wijRemoveVisibilityObserver&&e.element.wijRemoveVisibilityObserver()},"wijdropdown")},n.prototype._createSelect=function(){var e=this,n=e.options,r=e.options.wijCSS,i=e.element,s=i.width(),o=s,u=i.wrap("<div></div>").parent().addClass(r.helperHidden),a=u.wrap("<div></div>").parent().attr("role","select").addClass(r.wijdropdown).addClass(r.widget).addClass(r.stateDefault).addClass(r.cornerAll).addClass(r.helperClearFix),f=t("<label></label>").addClass(r.wijdropdownLabel).addClass(r.cornerAll).attr("id",i.get(0).id+"_select").attr("name",i.attr("name")||""),l=t("<div></div>").addClass(r.wijdropdownTrigger).addClass(r.stateDefault).addClass(r.cornerRight),c=t('<a href="#"></a>'),h=t("<div>").addClass(r.wijmodropdown),p=t("<ul></ul>").addClass(r.wijdropdownList).addClass(r.content).addClass(r.widget).addClass(r.cornerAll).addClass(r.helperReset).appendTo(h);t("<span></span>").addClass(r.icon).addClass(r.iconArrowDown).appendTo(l),s=Math.max(s,a.width()),i.get(0).tabIndex!==""&&c.attr("tabindex",i.attr("tabindex")),i.get(0).disabled!==!1&&(e.options.disabled=!0),e.options.disabled&&(c.addClass(r.stateDisabled),f.addClass(r.stateDisabled)),c.append(f),a.append(u).append(c).append(l),n.ensureDropDownOnBody?h.wrap(t("<div></div>").addClass(r.wijdropdown)).parent().appendTo("body").css("position","absolute"):a.append(h),o+=parseInt(f.css("padding-left").replace(/px/,""),10),o+=parseInt(f.css("padding-right").replace(/px/,""),10),o-=16,a.width(o),e._buildList(p,h,o),e._rightTrigger=l,e._label=f,e._listContainer=h,e._list=p,e._value=i.val(),e._selectedIndex=t("option",i).index(i.find("option:selected")),e._selectWrap=u,e._labelWrap=c,e._container=a,a.attr("title",i.attr("title")),i.removeAttr("title")},n.prototype._buildList=function(e,n,r){var i=this,s=i.options.wijCSS,o=i.element,u;n.show(),o.children().each(function(n,r){var o=t(r),u,a,f;return o.is("option")?e.append(i._buildItem(o)):(u=t("<li></li>").addClass(s.wijdropdownOptgroup),a=t("<span>"+o.attr("label")+"</span>").addClass(s.wijdropdownOptgroupHeader).addClass(s.priorityPrimary),f=t("<ul></ul>").addClass(s.helperReset).addClass(s.wijdropdownItems),o.children("option").each(function(){return f.append(i._buildItem(t(this))),this}),u.append(a).append(f),e.append(u)),this}),n.height(""),u=n.height(),u=e.outerHeight()<u?e.outerHeight():u,n.css({height:u,width:r}),t.browser.msie&&/^[8]\.[0-9]+/.test(t.browser.version)?e.setOutWidth(r-19):e.setOutWidth(r-18),n.data("wijmoWijsuperpanel")?(n.wijsuperpanel("paintPanel"),i.superpanel=n.data("wijmoWijsuperpanel")):i.superpanel=n.wijsuperpanel().data("wijmoWijsuperpanel"),t.fn.bgiframe&&i.superpanel.element.bgiframe(),i.superpanel.vNeedScrollBar||(t.browser.msie&&/^[8]\.[0-9]+/.test(t.browser.version)?e.setOutWidth(r-1):e.setOutWidth(r),i.superpanel.refresh()),n.hide()},n.prototype._handelEvents=function(e){var t=this,n=t.options.wijCSS,r="."+t.widgetName,i=t.element;e.bind("click"+r,function(n){if(t.options.disabled)return;t._listContainer.is(":hidden")?t._show():t._hide(),i.click(),e.get(0)===t._label.get(0)?n.preventDefault():t._labelWrap.focus()}).bind("mouseover"+r,function(){if(t.options.disabled)return;t._label.addClass(n.stateHover),t._rightTrigger.addClass(n.stateHover),i.trigger("mouseover")}).bind("mouseout"+r,function(){if(t.options.disabled)return;t._label.removeClass(n.stateHover),t._rightTrigger.removeClass(n.stateHover),i.trigger("mouseout")}).bind("mousedown"+r,function(){if(t.options.disabled)return;t._label.addClass(n.stateActive),t._rightTrigger.addClass(n.stateActive),i.trigger("mousedown")}).bind("mouseup"+r,function(){if(t.options.disabled)return;t._label.removeClass(n.stateActive),t._rightTrigger.removeClass(n.stateActive),i.trigger("mouseup")})},n.prototype._bindEvents=function(){var e=this,n=e.options.wijCSS,r="."+e.widgetName,i=e._label,s=e._rightTrigger,o=e._labelWrap,u=e._listContainer,a=e.element,f=!1,l;e._handelEvents(e._label),e._handelEvents(e._rightTrigger),t(window).bind("resize",function(t){e._setListContainerPosition()}),t(document).bind("mouseup"+r,function(t){if(u.is(":hidden")){i.removeClass(n.stateFocus),s.removeClass(n.stateFocus);return}l=u.offset();if(t.target===i.get(0)||t.target===s.get(0)||t.target===s.children().get(0))return;if(t.pageX<l.left||t.pageX>l.left+u.width()||t.pageY<l.top||t.pageY>l.top+u.height())i.removeClass(n.stateFocus),s.removeClass(n.stateFocus),e._hide()}),u.bind("click"+r,function(r){var i=t(r.target);i.closest("li."+n.wijdropdownItem,t(this).get(0)).length>0&&(e._setValue(),u.css("z-index",""),t.browser.msie&&/^[6,7].[0-9]+/.test(t.browser.version)&&u.parent().css("z-index",""),u.hide(),e._setValueToEle()),a.click()}),o.bind("keydown"+r,function(n){if(e.options.disabled)return;var r=t.ui.keyCode;switch(n.which){case r.UP:case r.LEFT:e._previous(),e._setValue(),e._setValueToEle();break;case r.DOWN:case r.RIGHT:e._next(),e._setValue(),e._setValueToEle();break;case r.PAGE_DOWN:e._nextPage(),e._setValue(),e._setValueToEle();break;case r.PAGE_UP:e._previousPage(),e._setValue(),e._setValueToEle();break;case r.ENTER:case r.NUMPAD_ENTER:e._setValue(),e._listContainer.hide(),e._setValueToEle()}n.which!==r.TAB&&n.preventDefault(),a.trigger("keydown")}).bind("focus"+r,function(){if(e.options.disabled)return;i.addClass(n.stateFocus),s.addClass(n.stateFocus),a.focus()}).bind("blur"+r,function(){if(e.options.disabled)return;i.removeClass(n.stateFocus),s.removeClass(n.stateFocus),a.trigger("blur")}).bind("keypress"+r,function(){if(e.options.disabled)return;a.trigger("keypress")}).bind("keyup"+r,function(){if(e.options.disabled)return;a.trigger("keyup")}),f=/chrome/.test(navigator.userAgent.toLowerCase());if(f||t.browser.safari)o.bind("click"+r,function(){o.focus()}),s.bind("mouseout"+r,function(){if(e.options.disabled)return;i.removeClass(n.stateFocus),s.removeClass(n.stateFocus)})},n.prototype._setListContainerPosition=function(){var e=this,t=e.options,n;if(!t.ensureDropDownOnBody)return;n=e._container.offset(),e._listContainer.parent().offset({left:n.left,top:n.top+e._container.outerHeight()})},n.prototype._init=function(){var e=this;e._initActiveItem(),e._activeItem&&e._label.text(e._activeItem.text())},n.prototype._buildItem=function(e){var n=e.val(),r=e.text(),i=this,s=i.options.wijCSS,o;return r===""&&(r="&nbsp;"),o=t("<li></li>").addClass(s.wijdropdownItem).addClass(s.cornerAll).append(t("<span>"+r+"</span>")).mousemove(function(e){var n=t(e.target).closest("."+s.wijdropdownItem);n!==this.last&&i._activate(t(this)),this.last=t(e.target).closest("."+s.wijdropdownItem)}).attr("role","option"),o.data("value",n),o},n.prototype._show=function(){var e=this,n=e._listContainer,r=e.options.showingAnimation;e._setListContainerPosition(),n.css("z-index","100000"),t.browser.msie&&/^[6,7]\.[0-9]+/.test(t.browser.version)&&n.parent().css("z-index","99999"),r?n.show(r.effect,r.options,r.speed,function(){e._initActiveItem()}):n.show()},n.prototype._hide=function(){var e=this,n=e._listContainer,r=e.options.hidingAnimation;if(n.is(":hidden"))return;r?n.hide(r.effect,r.options,r.speed,function(){t.isFunction(r.callback)&&r.callback.apply(e,arguments),t.browser.msie&&/^[6,7]\.[0-9]+/.test(t.browser.version)&&n.parent().css("z-index",""),n.css("z-index","")}):(t.browser.msie&&t.browser.version==="6.0"&&n.parent().css("z-index",""),n.css("z-index",""),n.hide())},n.prototype._setValue=function(){var e=this,n=e.options.wijCSS,r=e._listContainer,i,s;e._activeItem&&(e._label.text(e._activeItem.text()),e._value=e._activeItem.data("value"),e._selectedIndex=t("li."+n.wijdropdownItem,r).index(e._activeItem),e.superpanel.vNeedScrollBar&&(i=e._activeItem.offset().top,s=e._activeItem.outerHeight(),r.offset().top>i?r.wijsuperpanel("scrollTo",0,i-e._list.offset().top):r.offset().top<i+s-r.innerHeight()&&r.wijsuperpanel("scrollTo",0,i+s-r.height()-e._list.offset().top)))},n.prototype._setValueToEle=function(){var e=this,n=e.element,r=n.find(":selected"),i=t("option",n).index(r),s=e._selectedIndex;i!==s&&(t.browser.mozilla&&n.val(e._value),r.removeAttr("selected"),n.find("option:eq("+s+")").prop("selected",!0),n.trigger("change"))},n.prototype._initActiveItem=function(){var e=this,n=e.options.wijCSS;if(e._value!==undefined){if(e._selectedIndex===-1){e._activate(e._list.find("li."+n.wijdropdownItem).eq(0));return}e._list.find("li."+n.wijdropdownItem).each(function(n){if(n===e._selectedIndex)return e._activate(t(this)),!1})}},n.prototype._activate=function(e){var t=this,n=t.options.wijCSS;t._deactivate(),t._activeItem=e,t._activeItem.addClass(n.stateHover).attr("aria-selected",!0)},n.prototype._deactivate=function(){var e=this,t=e.options.wijCSS;e._activeItem&&e._activeItem.removeClass(t.stateHover).attr("aria-selected",!1)},n.prototype._next=function(){this._move("next","first")},n.prototype._previous=function(){this._move("prev","last")},n.prototype._nextPage=function(){this._movePage("first")},n.prototype._previousPage=function(){this._movePage("last")},n.prototype.refresh=function(){var e=this,n=e.options.wijCSS,r=e.element,i;if(e.needInit)e.element.is(":visible")&&(e._activeItem=null,e._createSelect(),e._bindEvents(),e._init(),e.needInit=!1);else{if(!e._list)return;e._listContainer.show(),e._selectWrap.removeClass(n.helperHidden),i=e.element.width(),i+=parseInt(e._label.css("padding-left").replace(/px/,""),10),i+=parseInt(e._label.css("padding-right").replace(/px/,""),10),i-=16,e._container.width(i),e._selectWrap.addClass(n.helperHidden),e._list.empty(),e._buildList(e._list,e._listContainer,i),e._value=e.element.val(),e._selectedIndex=t("option",r).index(r.find("option:selected")),e._initActiveItem(),e._activeItem&&e._label.text(e._activeItem.text())}},n.prototype._move=function(e,t){var n=this,r=n.options.wijCSS,i,s;if(!n._activeItem){n._activate(n._list.find("."+r.wijdropdownItem+":"+t));return}i=n._activeItem[e]().eq(0),i.length?s=n._getNextItem(i,e,t):n._activeItem.closest("."+r.wijdropdownOptgroup).length&&(s=n._getNextItem(n._activeItem.closest("."+r.wijdropdownOptgroup)[e](),e,t)),s&&s.length?n._activate(s):n._activate(n._list.find("."+r.wijdropdownItem+":"+t))},n.prototype._movePage=function(e){var n=this,r=n.options.wijCSS,i,s,o,u=e==="first"?"last":"first";n.superpanel.vNeedScrollBar?(i=n._activeItem.offset().top,s=n.options.height,o=n._list.find("."+r.wijdropdownItem).filter(function(){var n=t(this).offset().top-i+(e==="first"?-s:s)+t(this).height(),r=t(this).height();return n<r&&n>-r}),o.length||(o=n._list.find("."+r.wijdropdownItem+":"+u)),n._activate(o)):n._activate(n._list.find("."+r.wijdropdownItem+":"+(n._activeItem?u:e)))},n.prototype._getNextItem=function(e,t,n){var r=this.options.wijCSS;if(e.length){if(!e.is("."+r.wijdropdownOptgroup))return e;if(!!e.find(">ul>li."+r.wijdropdownItem).length)return e.find(">ul>li."+r.wijdropdownItem+":"+n).eq(0);this._getNextItem(e[t]().eq(0))}},n.prototype.destroy=function(){var t=this,n=t.options.wijCSS;this.element.attr("title",this._container.attr("title")),this.element.closest("."+n.wijdropdown).find(">div."+n.wijdropdownTrigger+",>div."+n.wijmodropdown+",>a").remove(),this._listContainer.remove(),this.element.unwrap().unwrap().removeData("maxZIndex"),e.prototype.destroy.call(this)},n}(e.wijmoWidget);e.wijdropdown=r;var i=function(){function e(){this.initSelector=":jqmData(role='wijdropdown')",this.wijCSS={wijmodropdown:"wijmo-dropdown",wijdropdown:"wijmo-wijdropdown",wijdropdownLabel:"wijmo-dropdown-label",wijdropdownTrigger:"wijmo-dropdown-trigger",wijdropdownList:"wijmo-dropdown-list",wijdropdownOptgroup:"wijmo-dropdown-optgroup",wijdropdownOptgroupHeader:"wijmo-optgroup-header",wijdropdownItems:"wijmo-dropdown-items",wijdropdownItem:"wijmo-dropdown-item"},this.zIndex=1e3,this.showingAnimation={effect:"blind"},this.hidingAnimation={effect:"blind"},this.ensureDropDownOnBody=!1}return e}();r.prototype.options=t.extend(!0,{},e.wijmoWidget.prototype.options,new i),t.wijmo.registerWidget(n,r.prototype)})(wijmo||(wijmo={}));